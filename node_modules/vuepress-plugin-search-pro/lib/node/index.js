import{getDirname as S,path as b}from"@vuepress/utils";import{watch as k}from"chokidar";import{useSassPalettePlugin as w}from"vuepress-plugin-sass-palette";import{utoa as g,getLocales as _,addViteSsrNoExternal as E}from"vuepress-shared/node";import{load as C}from"cheerio";const O={"/en/":{cancel:"Cancel",placeholder:"Search",search:"Search",select:"to select",navigate:"to navigate",exit:"to exit",history:"Search History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."},"/zh/":{cancel:"取消",placeholder:"搜索",search:"搜索",select:"选择",navigate:"切换",exit:"关闭",history:"搜索历史",emptyHistory:"无搜索历史",emptyResult:"没有找到结果",loading:"正在加载搜索索引..."},"/zh-tw/":{cancel:"取消",placeholder:"搜索",search:"搜素",select:"選擇",navigate:"切換",exit:"關閉",history:"搜索歷史",emptyHistory:"無搜索歷史",emptyResult:"沒有找到結果",loading:"正在加載搜索索引..."},"/de-at/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",select:"auswählen",navigate:"wechseln",exit:"schließen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/vi/":{cancel:"Hủy",placeholder:"Tìm kiếm",search:"Tìm kiếm",select:"chọn",navigate:"chuyển",exit:"đóng",history:"Lịch sử tìm kiếm",emptyHistory:"Xóa lịch sử tìm kiếm",emptyResult:"Không tìm thấy kết quả",loading:"Đang tải chỉ mục tìm kiếm..."},"/uk/":{cancel:"Скасувати",placeholder:"Пошук",search:"Пошук",select:"вибрати",navigate:"перейти",exit:"закрити",history:"Історія пошуку",emptyHistory:"Очистити історію пошуку",emptyResult:"Нічого не знайдено",loading:"Завантаження пошукових індексів..."},"/ru/":{cancel:"Отмена",placeholder:"Поиск",search:"Поиск",select:"выбрать",navigate:"переключить",exit:"закрыть",history:"История поиска",emptyHistory:"Очистить историю поиска",emptyResult:"Ничего не найдено",loading:"Загрузка поисковых индексов..."},"/br/":{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",select:"selecionar",navigate:"navegar",exit:"fechar",history:"Histórico de pesquisa",emptyHistory:"Limpar histórico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando índices de pesquisa..."},"/pl/":{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",select:"wybierz",navigate:"przejdź",exit:"zamknij",history:"Historia wyszukiwania",emptyHistory:"Wyczyść historię wyszukiwania",emptyResult:"Nie znaleziono wyników",loading:"Ładowanie indeksów wyszukiwania..."},"/sk/":{cancel:"Zrušiť",placeholder:"Hľadať",search:"Hľadať",select:"vybrať",navigate:"prepnúť",exit:"zavrieť",history:"História vyhľadávania",emptyHistory:"Vymazať históriu vyhľadávania",emptyResult:"Nenašli sa žiadne výsledky",loading:"Načítavajú sa vyhľadávacie indexy..."},"/fr/":{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",select:"sélectionner",navigate:"naviguer",exit:"fermer",history:"Historique de recherche",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun résultat trouvé",loading:"Chargement des index de recherche..."},"/es/":{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",select:"seleccionar",navigate:"navegar",exit:"cerrar",history:"Historial de búsqueda",emptyHistory:"Vaciar historial de búsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando índices de búsqueda..."},"/ja/":{cancel:"キャンセル",placeholder:"検索",search:"検索",select:"選択",navigate:"切り替え",exit:"閉じる",history:"検索履歴",emptyHistory:"検索履歴をクリア",emptyResult:"結果が見つかりません",loading:"検索インデックスを読み込んでいます..."},"/tr/":{cancel:"İptal",placeholder:"Ara",search:"Ara",select:"seç",navigate:"geç",exit:"kapat",history:"Arama geçmişi",emptyHistory:"Arama geçmişini temizle",emptyResult:"Sonuç bulunamadı",loading:"Arama dizinleri yükleniyor..."},"/ko/":{cancel:"취소",placeholder:"검색",search:"검색",select:"선택",navigate:"이동",exit:"닫기",history:"검색 기록",emptyHistory:"검색 기록 지우기",emptyResult:"결과를 찾을 수 없습니다",loading:"검색 인덱스를 로드하는 중..."}},P="h1,h2,h3,h4,h5,h6".split(","),j="header,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,tfoot".split(","),A="routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),z=C(""),x=(e,d=[],a=!1)=>{const o=e.excerpt.length>0,r={title:e.title,contents:[]};let n=o||a,l="",t={header:"",slug:"",contents:[]},i=!0;const c=s=>{s.type==="tag"?P.includes(s.name)?(l&&n&&(t==null||t.contents.push(l.replace(/\s+/gu," ")),l=""),i?(t.contents.length&&r.contents.push(t),i=!1):r.contents.push(t),t={header:s.children.map(p=>p.type==="text"?p.data:"").join("").trim(),slug:s.attribs.id,contents:[]}):j.includes(s.name)?(l&&n&&(t==null||t.contents.push(l.replace(/\s+/gu," ")),l=""),s.childNodes.forEach(c)):A.includes(s.name)&&s.childNodes.forEach(c):s.type==="text"?l+=s.data.trim()?s.data:"":o&&!a&&s.type==="comment"&&s.data.trim()==="more"&&(n=!1)},u=z.parseHTML(e.contentRendered),y=Object.fromEntries(d.map(({getter:s},p)=>{const m=s(e);return Array.isArray(m)?[p.toString(),m]:m?[p.toString(),[m]]:null}).filter(s=>s!==null));return!(u!=null&&u.length)&&!Object.keys(y).length?null:(u==null||u.forEach(s=>{c(s)}),n&&l&&(t==null||t.contents.push(l)),t.contents.length&&r.contents.push(t),{...r,...Object.keys(y).length?{customFields:y}:{}})},v=`
if (import.meta.webpackHot) {
  import.meta.webpackHot.accept()
  if (__VUE_HMR_RUNTIME__.updateSearchProDatabase)
    __VUE_HMR_RUNTIME__.updateSearchProDatabase(database)
}

if (import.meta.hot) {
  import.meta.hot.accept(({ database }) => {
    __VUE_HMR_RUNTIME__.updateSearchProDatabase(database);
  })
}
`;let h=null;const f=async({env:e,pages:d,options:a,writeTemp:o},r)=>{const n=d.map(i=>{const c=x(i,r.customFields,r.indexContent);return c?{path:i.path,index:c,localePath:i.pathLocale}:null}).filter(i=>i!==null),l=Object.fromEntries(Object.keys({"/":{},...a.locales}).map(i=>[i,Object.fromEntries(n.filter(c=>c.localePath===i).map(c=>[c.path,c.index]))]));h=l;let t=`export const database = "${g(JSON.stringify(l))}"
`;e.isDev&&(t+=v),await o("search-pro/index.js",t)},R=async(e,d,a)=>{if(h){const o=a.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{env:r,pages:n,writeTemp:l}=e,t=n.find(({filePathRelative:i})=>(i==null?void 0:i.toLowerCase())===o.toLowerCase());if(t){const i=x(t,d.customFields,d.indexContent);if(i){h[t.pathLocale][t.path]=i;let c=`export const database = "${g(JSON.stringify(h))}"
`;r.isDev&&(c+=v),await l("search-pro/index.js",c);return}}}await f(e,d)},L=async(e,d,a)=>{if(h){const o=a.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{env:r,pages:n,writeTemp:l}=e,t=n.find(({filePathRelative:i})=>(i==null?void 0:i.toLowerCase())===o.toLowerCase());if(t){delete h[t.pathLocale][t.path];let i=`export const database = "${g(JSON.stringify(h))}"
`;r.isDev&&(i+=v),await l("search-pro/index.js",i);return}}await f(e,d)},H=S(import.meta.url),N=e=>d=>(w(d,{id:"hope"}),{name:"vuepress-plugin-search-pro",alias:{"vuepress-plugin-search-pro/result":b.resolve(H,"../client/components/SearchResult.js")},define:{SEARCH_PRO_CUSTOM_FIELDS:Object.fromEntries((e.customFields||[]).map(({formatter:a},o)=>a?[(o.toString(),a)]:null).filter(a=>a!==null)),SEARCH_PRO_DELAY:e.delay||300,SEARCH_PRO_HISTORY_COUNT:e.historyCount||5,SEARCH_PRO_HOTKEYS:e.hotKeys||[{key:"k",ctrl:!0}],SEARCH_PRO_LOCALES:_({app:d,name:"search-pro",config:e.locales,default:O})},clientConfigFile:b.resolve(H,"../client/config.js"),extendsBundlerOptions:(a,o)=>{E({app:o,config:a},["fflate","vuepress-shared"])},onPrepared:a=>f(a,e),onWatched:(a,o)=>{if("hotReload"in e?e.hotReload:a.env.isDebug){const r=k("pages/**/*.vue",{cwd:a.dir.temp(),ignoreInitial:!0});r.on("add",n=>{R(a,e,n)}),r.on("change",n=>{R(a,e,n)}),r.on("unlink",n=>{L(a,e,n)}),o.push(r)}}});export{N as searchProPlugin};
//# sourceMappingURL=index.js.map
